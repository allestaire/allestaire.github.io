(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{926:function(e,t,r){Promise.resolve().then(r.bind(r,7072))},7072:function(e,t,r){"use strict";r.r(t);var i=r(9268),a=r(6006),n=r(353),l=r(8852),o=r(4066),s=r(5991),c=r(4240),h=r(7295),d=r(1071),u=r(2737),x=r(9454),m=r(9244),g=r(7467),p=r(7931),j=r(2992),b=r(7013);let f={jpg:"image/jpeg",png:"image/png"},Z={pz:{x:1,y:1},nz:{x:3,y:1},px:{x:2,y:1},nx:{x:0,y:1},py:{x:1,y:0},ny:{x:1,y:2}},v=0,C=[];{let e=document.createElement("canvas");e.getContext("2d")}function w(e,t){return CANVAS.width=e.width,CANVAS.height=e.height,CTX.putImageData(e,0,0),new Promise(e=>{CANVAS.toBlob(t=>e(URL.createObjectURL(t)),f[t],.92)})}let y=()=>{let e=(0,a.useRef)(null),t=(0,a.useRef)(null),[r,f]=(0,a.useState)(!1),y=(0,l.TA)({initialValues:{image:null,cubeRotation:180,interpolation:"lanczos",format:"jpg"},validationSchema:n.Ry({image:n.nK().required(),cubeRotation:n.Rx().required().max(359),interpolation:n.Z_().required().matches(/lanczos|cubic|linear/),format:n.Z_().required().matches(/png|jpg/)}),onSubmit(t){let r=new Image;r.src=URL.createObjectURL(t.image),r.addEventListener("load",()=>{let{width:i,height:a}=r;CANVAS.width=i,CANVAS.height=a,CTX.drawImage(r,0,0);let n=CTX.getImageData(0,0,i,a);if(4*n.height!=n.width)window.alert("The image width is not ratioed to 2:1 !!");else{for(;e.current.firstChild;)e.current.removeChild(e.current.firstChild);for(let e of(f(!0),C))e.terminate();for(let[r,i]of Object.entries(Z)){let a=new CubeFace(r);e.current.appendChild(a.anchor);let l={data:n,face:r,rotation:Math.PI*parseInt(t.cubeRotation)/180,interpolation:t.interpolation},o=new Worker("/marzipano/js/convert.js"),s=e=>{let{data:r}=e,i=t.format;w(r,i).then(e=>a.setDownload(e,i)),console.log("Finished "+ ++v),6===v&&(f(!1),v=0,C=[])},c=e=>{let{data:t}=e,r=t.width*i.x,n=t.height*i.y;w(t,"jpg").then(e=>a.setPreview(e,r,n)),o.onmessage=s,o.postMessage(l)};o.onmessage=c,o.postMessage(Object.assign({},l,{maxWidth:200,interpolation:"linear"})),C.push(o)}}})}}),P=()=>{t.current.click()},R=e=>{if(e.target.files.length>0){let t=e.target.files[0];y.setFieldValue("image",t)}};return(0,a.useEffect)(()=>{},[y.values]),(0,i.jsxs)("div",{children:[r&&(0,i.jsx)(b.Z,{open:!0,message:"Generating . . .",anchorOrigin:{vertical:"bottom",horizontal:"right"}}),(0,i.jsx)("input",{type:"file",ref:t,onChange:R,style:{display:"none"}}),(0,i.jsxs)(o.ZP,{container:!0,spacing:2,sx:{p:5},children:[(0,i.jsx)(o.ZP,{item:!0,xs:12,children:(0,i.jsx)(s.Z,{elevation:5,sx:{p:3},children:(0,i.jsx)(c.Z,{variant:"h4",children:"Straigthen Your Panorama"})})}),(0,i.jsx)(o.ZP,{item:!0,xs:12,children:(0,i.jsxs)(s.Z,{elevation:5,sx:{p:3},children:[(0,i.jsx)(c.Z,{variant:"h4",children:"Generate Cubemap image from Panorama"}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(c.Z,{children:"The image should be formatted with the equirectangular projection."})}),(0,i.jsx)("li",{children:(0,i.jsx)(c.Z,{children:"The image should have an aspect ratio of 2:1 (the width must be exactly twice the height)."})})]}),(0,i.jsx)("br",{}),(0,i.jsxs)(o.ZP,{container:!0,spacing:2,children:[(0,i.jsxs)(o.ZP,{item:!0,xs:12,children:[(0,i.jsx)(p.Z,{type:"primary",variant:"contained",color:y.touched.image&&y.errors.image?"error":"primary",size:"large",onClick:P,children:"Browse File"}),!!y.errors.image&&(0,i.jsx)(j.Z,{error:!0,children:y.errors.image})]}),(0,i.jsx)(o.ZP,{item:!0,xs:6,children:(0,i.jsx)(h.Z,{label:"Cube Rotation (in degree)",variant:"outlined",fullWidth:!0,name:"cubeRotation",value:y.values.cubeRotation,onChange:y.handleChange,error:!!y.errors.cubeRotation,helperText:!!y.errors.cubeRotation&&y.errors.cubeRotation})}),(0,i.jsxs)(o.ZP,{item:!0,xs:12,children:[(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(g.Z,{id:"interpolation-type-label",children:"Interpolation type"}),(0,i.jsxs)(u.Z,{row:!0,"aria-labelledby":"interpolation-type-label",name:"interpolation",value:y.values.interpolation,onChange:y.handleChange,children:[(0,i.jsx)(x.Z,{value:"lanczos",control:(0,i.jsx)(d.Z,{}),label:"Lanczos (best but slower)"}),(0,i.jsx)(x.Z,{value:"cubic",control:(0,i.jsx)(d.Z,{}),label:"Cubic (sharper details)"}),(0,i.jsx)(x.Z,{value:"linear",control:(0,i.jsx)(d.Z,{}),label:"Linear (softer details)"})]})]}),!!y.errors.interpolation&&(0,i.jsx)(j.Z,{error:!0,children:y.errors.interpolation})]}),(0,i.jsxs)(o.ZP,{item:!0,xs:12,children:[(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(g.Z,{id:"output-format-label",children:"Output Format"}),(0,i.jsxs)(u.Z,{row:!0,"aria-labelledby":"output-format-label",name:"format",value:y.values.format,onChange:y.handleChange,children:[(0,i.jsx)(x.Z,{value:"png",control:(0,i.jsx)(d.Z,{}),label:"PNG"}),(0,i.jsx)(x.Z,{value:"jpg",control:(0,i.jsx)(d.Z,{}),label:"JPEG"})]})]}),!!y.errors.format&&(0,i.jsx)(j.Z,{error:!0,children:y.errors.format})]}),(0,i.jsxs)(o.ZP,{item:!0,xs:12,children:[(0,i.jsx)(c.Z,{children:"Click each cube face to save it to your computer"}),(0,i.jsx)("div",{style:{width:800,height:600,background:"#eee"},children:(0,i.jsx)("output",{style:{position:"relative"},ref:e})})]}),(0,i.jsx)(o.ZP,{item:!0,xs:12,children:(0,i.jsx)(p.Z,{variant:"contained",size:"large",onClick:y.handleSubmit,children:"Generate"})})]})]})})]})]})};t.default=y}},function(e){e.O(0,[550,747,281,530,713,667,139,744],function(){return e(e.s=926)}),_N_E=e.O()}]);