(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{926:function(e,t,r){Promise.resolve().then(r.bind(r,7796))},7796:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return T}});var a=r(9268),i=r(6006),n=r(353),l=r(8852),s=r(4066),o=r(9985),c=r.n(o),h=r(1771),d=r(5991),u=r(4240),x=r(7931),m=r(7295),g=r(9182),p=r(5094),j=r(4472),f=r(6998),b=r(9504),Z=r.n(b);r(3699);let v=null,y=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),[r,n]=(0,i.useState)(null),l=t=>{let r=t.target.files;if(r.length>0){let t=r[0];n(t),e.current.src=URL.createObjectURL(t),e.current.style.width="",e.current.style.margin="",v&&v.destroy(),v=new(Z())(e.current,{dragMode:"move",autoCrop:!1,scalable:!1})}},s=()=>{t.current.click()},o=()=>{v.rotate(-1)},b=()=>{v.rotate(1)},y=()=>{v.getCroppedCanvas().toBlob(e=>{c().saveAs(e,"rotate-"+v.imageData.rotate+"-"+r.name)})};return(0,a.jsxs)(d.Z,{elevation:5,sx:{p:3},children:[(0,a.jsx)("input",{type:"file",ref:t,onChange:l,style:{display:"none"},accept:"image/*"}),(0,a.jsx)(u.Z,{variant:"h4",children:"Straigthen Your Panorama"}),(0,a.jsxs)(h.Z,{sx:{display:"flex",pb:2,mt:2},children:[(0,a.jsx)(h.Z,{sx:{flexGrow:1},children:(0,a.jsx)(m.Z,{label:"Degree",fullWidth:!0,defaultValue:1})}),(0,a.jsxs)(x.Z,{variant:"contained",sx:{mx:2},onClick:o,children:[(0,a.jsx)(p.Z,{})," Rotate Left"]}),(0,a.jsxs)(x.Z,{variant:"contained",onClick:b,children:[(0,a.jsx)(g.Z,{})," Rotate Right"]}),(0,a.jsxs)(x.Z,{variant:"contained",sx:{ml:2},onClick:s,children:[(0,a.jsx)(j.Z,{})," Browse File"]}),(0,a.jsx)(x.Z,{color:"primary",onClick:y,children:(0,a.jsx)(f.Z,{})})]}),(0,a.jsxs)(h.Z,{style:{background:"#eee",width:"100%",height:r?"":"500px",display:"flex",alignItems:"center"},children:[(0,a.jsx)("img",{style:{maxWidth:"100%",width:200,margin:"0 auto"},ref:e,src:"/marzipano/imgs/icons/undraw_asset_selection_re_k5fj.svg",alt:"image"}),(0,a.jsx)(h.Z,{sx:{width:"calc(100% - 80px)",left:40,height:2,background:"red",position:"absolute"}})]})]})};var w=r(1071),C=r(2737),R=r(9454),P=r(9244),k=r(7467),z=r(2992),_=r(7013);let L={jpg:"image/jpeg",png:"image/png"},E={pz:{x:1,y:1},nz:{x:3,y:1},px:{x:2,y:1},nx:{x:0,y:1},py:{x:1,y:0},ny:{x:1,y:2}},O={pz:"f",nz:"b",px:"r",nx:"l",py:"u",ny:"d"},I=0,D=[],F=null,G=null;G=(F=document.createElement("canvas")).getContext("2d");class N{setPreview(e,t,r){this.img.src=e,this.anchor.style.left="".concat(t,"px"),this.anchor.style.top="".concat(r,"px")}setDownload(e,t){this.anchor.href=e,this.anchor.download="".concat(O[this.faceName],".").concat(t),this.img.style.filter=""}constructor(e){this.faceName=e,this.anchor=document.createElement("a"),this.anchor.style.position="absolute",this.anchor.title=e,this.img=document.createElement("img"),this.img.style.filter="blur(4px)",this.anchor.appendChild(this.img)}}function S(e,t){return F.width=e.width,F.height=e.height,G.putImageData(e,0,0),new Promise(e=>{F.toBlob(t=>e(URL.createObjectURL(t)),L[t],.92)})}let U=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),[r,o]=(0,i.useState)(!1),c=(0,l.TA)({initialValues:{image:null,cubeRotation:180,interpolation:"lanczos",format:"jpg"},validationSchema:n.Ry({image:n.nK().required(),cubeRotation:n.Rx().required().max(359),interpolation:n.Z_().required().matches(/lanczos|cubic|linear/),format:n.Z_().required().matches(/png|jpg/)}),onSubmit(t){let r=new Image;r.src=URL.createObjectURL(t.image),r.addEventListener("load",()=>{let{width:a,height:i}=r;F.width=a,F.height=i,G.drawImage(r,0,0);let n=G.getImageData(0,0,a,i);if(4*n.height!=n.width)window.alert("The image width is not ratioed to 2:1 !!");else{for(;e.current.firstChild;)e.current.removeChild(e.current.firstChild);for(let e of(o(!0),D))e.terminate();for(let[r,a]of Object.entries(E)){let i=new N(r);e.current.appendChild(i.anchor);let l={data:n,face:r,rotation:Math.PI*parseInt(t.cubeRotation)/180,interpolation:t.interpolation},s=new Worker("/marzipano/js/convert.js"),c=e=>{let{data:r}=e,a=t.format;S(r,a).then(e=>i.setDownload(e,a)),console.log("Finished "+ ++I),6===I&&(o(!1),I=0,D=[])},h=e=>{let{data:t}=e,r=t.width*a.x,n=t.height*a.y;S(t,"jpg").then(e=>i.setPreview(e,r,n)),s.onmessage=c,s.postMessage(l)};s.onmessage=h,s.postMessage(Object.assign({},l,{maxWidth:200,interpolation:"linear"})),D.push(s)}}})}}),h=()=>{t.current.click()},g=e=>{if(e.target.files.length>0){let t=e.target.files[0];c.setFieldValue("image",t)}};return(0,i.useEffect)(()=>{},[c.values]),(0,a.jsxs)(i.Fragment,{children:[r&&(0,a.jsx)(_.Z,{open:!0,message:"Generating . . .",anchorOrigin:{vertical:"bottom",horizontal:"right"}}),(0,a.jsx)("input",{type:"file",ref:t,onChange:g,style:{display:"none"},accept:"image/*"}),(0,a.jsxs)(d.Z,{elevation:5,sx:{p:3},children:[(0,a.jsx)(u.Z,{variant:"h4",children:"Generate Cubemap image from Panorama"}),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:(0,a.jsx)(u.Z,{children:"The image should be formatted with the equirectangular projection."})}),(0,a.jsx)("li",{children:(0,a.jsx)(u.Z,{children:"The image should have an aspect ratio of 2:1 (the width must be exactly twice the height)."})})]}),(0,a.jsx)("br",{}),(0,a.jsxs)(s.ZP,{container:!0,spacing:2,children:[(0,a.jsxs)(s.ZP,{item:!0,xs:12,children:[(0,a.jsx)(x.Z,{type:"primary",variant:"contained",color:c.touched.image&&c.errors.image?"error":"primary",size:"large",onClick:h,children:"Browse File"}),!!c.errors.image&&(0,a.jsx)(z.Z,{error:!0,children:c.errors.image})]}),(0,a.jsx)(s.ZP,{item:!0,xs:6,children:(0,a.jsx)(m.Z,{label:"Cube Rotation (in degree)",variant:"outlined",fullWidth:!0,name:"cubeRotation",value:c.values.cubeRotation,onChange:c.handleChange,error:!!c.errors.cubeRotation,helperText:!!c.errors.cubeRotation&&c.errors.cubeRotation})}),(0,a.jsxs)(s.ZP,{item:!0,xs:12,children:[(0,a.jsxs)(P.Z,{children:[(0,a.jsx)(k.Z,{id:"interpolation-type-label",children:"Interpolation type"}),(0,a.jsxs)(C.Z,{row:!0,"aria-labelledby":"interpolation-type-label",name:"interpolation",value:c.values.interpolation,onChange:c.handleChange,children:[(0,a.jsx)(R.Z,{value:"lanczos",control:(0,a.jsx)(w.Z,{}),label:"Lanczos (best but slower)"}),(0,a.jsx)(R.Z,{value:"cubic",control:(0,a.jsx)(w.Z,{}),label:"Cubic (sharper details)"}),(0,a.jsx)(R.Z,{value:"linear",control:(0,a.jsx)(w.Z,{}),label:"Linear (softer details)"})]})]}),!!c.errors.interpolation&&(0,a.jsx)(z.Z,{error:!0,children:c.errors.interpolation})]}),(0,a.jsxs)(s.ZP,{item:!0,xs:12,children:[(0,a.jsxs)(P.Z,{children:[(0,a.jsx)(k.Z,{id:"output-format-label",children:"Output Format"}),(0,a.jsxs)(C.Z,{row:!0,"aria-labelledby":"output-format-label",name:"format",value:c.values.format,onChange:c.handleChange,children:[(0,a.jsx)(R.Z,{value:"png",control:(0,a.jsx)(w.Z,{}),label:"PNG"}),(0,a.jsx)(R.Z,{value:"jpg",control:(0,a.jsx)(w.Z,{}),label:"JPEG"})]})]}),!!c.errors.format&&(0,a.jsx)(z.Z,{error:!0,children:c.errors.format})]}),(0,a.jsxs)(s.ZP,{item:!0,xs:12,children:[(0,a.jsx)(u.Z,{children:"Click each cube face to save it to your computer"}),(0,a.jsx)("div",{style:{width:800,height:600,background:"#eee"},children:(0,a.jsx)("output",{style:{position:"relative"},ref:e})})]}),(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{variant:"contained",size:"large",onClick:c.handleSubmit,children:"Generate"})})]})]})]})},q=()=>(0,a.jsx)("div",{children:(0,a.jsxs)(s.ZP,{container:!0,spacing:2,sx:{p:5},children:[(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(y,{})}),(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(U,{})})]})});var T=q}},function(e){e.O(0,[550,358,281,530,828,667,139,744],function(){return e(e.s=926)}),_N_E=e.O()}]);